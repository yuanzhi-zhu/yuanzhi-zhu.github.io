<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" class="han-init" lang="zh-cmn-Hans"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Introduction to Real NVP — Yuanzhi Zhu</title>
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/primer.css">
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/user-content.min.css">
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/octicons.css">
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/collection.css">
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/repo-card.css">
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/repo-list.css">
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/mini-repo-list.css">
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/boxed-group.css">
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/common.css">
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/share.min.css">
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/responsive.css">
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/index.css">
    <!-- Latest compiled and minified CSS -->
    

    
    <link rel="canonical" href="http://localhost:4000/2022/06/21/Real-NVP-Intro/">
    <link rel="alternate" type="application/atom+xml" title="Yuanzhi Zhu" href="http://localhost:4000/feed.xml">
    <!-- <link rel="shortcut icon" href="http://localhost:4000/favicon.ico"> -->
    <link rel="shortcut icon" href="http://localhost:4000/icon.jpg">
    
    <meta property="og:title" content="Introduction to Real NVP">
      
    <meta name="keywords" content="Computer Vision, Normalizing Flow, Real NVP">
    <meta name="og:keywords" content="Computer Vision, Normalizing Flow, Real NVP">
      
    <meta name="description" content="Prerequisite: Normalizing Flow">
    <meta name="og:description" content="Prerequisite: Normalizing Flow">
      
    
    
        
    
    <meta property="og:url" content="http://localhost:4000/2022/06/21/Real-NVP-Intro/">
    <meta property="og:site_name" content="Yuanzhi Zhu">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh_CN">
    
    <meta property="article:published_time" content="2022-06-21">
    
    <script src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/jquery.min.js"></script>
    <script src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/jquery-ui.js"></script>
    <script src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/main.js"></script>

    
        <script type="text/x-mathjax-config;executed=true">
  MathJax.Hub.Config({
      extensions: ["tex2jax.js"],
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true,
          processEnvironments: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          TeX: { equationNumbers: { autoNumber: "AMS" },
               extensions: ["AMSmath.js", "AMSsymbols.js"] }
      },
  "HTML-CSS": { availableFonts: ["TeX"] }
});
</script>

<script type="text/x-mathjax-config;executed=true">
  MathJax.Hub.Queue(function() {
    // Fix <code> tags after MathJax finishes running. This is a
    // hack to overcome a shortcoming of Markdown. Discussion at
    // https://github.com/mojombo/jekyll/issues/199
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/MathJax.js" id=""></script>
    
    <!--
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    -->
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.1') format('opentype'); font-weight: bold}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.1') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Math; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.1') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.1') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body class="" data-mz=""><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px none; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
    <header class="site-header">
        <div class="container">
            <h1><a href="http://localhost:4000/" title="Yuanzhi Zhu"><span class="octicon octicon-mark-github"><font color="black">Yuanzhi Zhu</font></span> </a></h1>
            <button class="collapsed mobile-visible" type="button" onclick="toggleMenu();">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <nav class="site-header-nav" role="navigation">
                
                <a href="http://localhost:4000/" class=" site-header-nav-item" target="" title="Home"><font color="black">Home</font></a>
                
                <a href="http://localhost:4000/about/" class=" site-header-nav-item" target="" title="About"><font color="black">About</font></a>
                
            </nav>
        </div>
    </header>
    <!-- / header -->

    <!--
<section class="collection-head small geopattern" data-pattern-id="Introduction to">
  <div class="container">
    <div class="columns">
      <div class="column three-fourths">
        <div class="collection-title">
          <h1 class="collection-header">Introduction to Real NVP</h1>
          <div class="collection-info">
            
            <span class="meta-info">
              <span class="octicon octicon-calendar"></span> 2022/06/21
            </span>
             
            <span class="meta-info">
              <span class="octicon octicon-file-directory"></span>
              <a href="http://localhost:4000/categories/#Research" title="Research">Research</a>
            </span>
            
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
-->

<!-- / .banner -->
<section class="container content">
<div class="columns">
  <!--
                <div class="column two-thirds">
                    <article class="article-content markdown-body">
                        <p><strong>Prerequisite</strong>: Normalizing Flow</p>

<h1 id="overview">Overview</h1>

<p><strong>Normalizing Flow (NF)</strong> is a kind of generative model just like GANs and VAEs but provides injective mapping between data $X$ and latent variable $Z$ (from a simple distribution) with exact likelihood calculations. Among all the NFs, real NVP is one of the most important, which stands for real-valued non-volume preserving (real NVP) transformation, a set of powerful invertible and learnable transformations.</p>

<p><strong>Target</strong>: The goal here is to build a learnable, reversible transformation between a source domain (distribution) and a latent(simple distribution) domain $Z$ or another target domain. 
Just like most of the other NFs, we can train the real NVP by doing maximum likelihood estimation (MLE).</p>

<p>From now on we just consider the following situation: source domain is images of a style and target domain is Gaussian distribution.</p>

<p>We need to first write the likelihood of source images $p_X(X)$ in a form that is easy to compute.
Given an image $x \in X$, a simple prior probability distribution $p_Z$ on a latent variable $z \in Z$, and a bijection $f : X \rightarrow Z$ (with $g = f^{−1}$ ), the change of variable formula defines a model distribution on $X$ by (as we assume $p_Z$ is Gaussian):</p>

\[p_X(x) = p_Z(f(x))\left| \text{det}\left(\frac{\partial f(x)}{\partial x^T}\right)\right|\]

\[\text{log}(p_X(x)) = \text{log}\left(p_Z(f(x))\right) + \text{log} \left( \left| \text{det}\left(\frac{\partial f(x)}{\partial x^T}\right)\right|\right)\]

<p>where $p_Z(f(x))$ is easy to get given $z=f(x)$, $\mid \text{det}(\frac{\partial f(x)}{\partial x^T})\mid$ is the determinant of Jacobian, which can be construct to be computational efficient, too.</p>

<p>$f$ can be decomposed to many invertible component: $f = f_1 \circ f_2 \circ … \circ f_n$ just like deep neural network.</p>

<p>We describe here a batch of images as tensor of size $\text{batch}.\text{size}() = (B,C,H,W)$.</p>

<p>For simplicity, we set batch_size $B=1$. 
For any input image, we expect to get a latent variable $z\sim N(0,1)$. In order to calculate $\text{log} p_X(x)$, the model is also required to keep track the sum of log determinant of Jacobian (sldj) $J = \log \det \frac{\partial f(x)}{\partial x^T}$.</p>

<h1 id="pre-process">Pre-process</h1>

<p>We further assume the value of each element in this tensor $\in [0,1]$.</p>

<p>The next step is to de-quantize these images, to make the values a continues distribution. (Since the discrete data distribution has differential entropy of negative infinity, this can lead to arbitrary high likelihoods even on test data. To avoid this case, it is becoming best practice to add real-valued noise to the integer pixel values to de-quantize the data):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mf">255.</span> <span class="o">+</span> <span class="n">torch</span><span class="p">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="mf">256.</span>      <span class="c1"># [0,1] with noise
</span></code></pre></div></div>
<p>Notice: now for the same input images, the model will give each time slightly different $z\in Z$.</p>

<p>According to https://arxiv.org/abs/1605.08803, Section 4.1, we will model logits:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">log</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span><span class="p">).</span><span class="n">log</span><span class="p">()</span>            
</code></pre></div></div>
<p>Since $x\in [0,1]$, it’s dangerous to apply directly log to them, so we apply a data_constraint $\beta=0.9$ to $x$:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Convert to logits
</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_constraint</span>  <span class="c1"># [-0.9, 0.9]
</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>                         <span class="c1"># [0.05, 0.95]
</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">.</span><span class="n">log</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">y</span><span class="p">).</span><span class="n">log</span><span class="p">()</span>            <span class="c1"># logit: y=log((((2x-1)beta+1)/2)/(1-((2x-1)beta+1)/2))          
</span></code></pre></div></div>

<p>Now let compute the sldj of pre-process step.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Save log-determinant of Jacobian of initial transform
# Softplus(x) = 1/beta*log(1+exp(beta*x)) (default beta=1) element-wise: activation function
</span><span class="n">ldj</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="n">softplus</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="p">.</span><span class="n">softplus</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span> \
    <span class="o">-</span> <span class="n">F</span><span class="p">.</span><span class="n">softplus</span><span class="p">((</span><span class="mf">1.</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_constraint</span><span class="p">).</span><span class="n">log</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_constraint</span><span class="p">.</span><span class="n">log</span><span class="p">())</span>
<span class="c1"># sum up pixels and channels of every in each batch
</span><span class="n">ldj</span> <span class="o">=</span> <span class="n">ldj</span><span class="p">.</span><span class="n">view</span><span class="p">(</span><span class="n">ldj</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nb">sum</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>As commented above, $\text{F.softplus}(x) = \text{log}(1+e^{x})$, and it’s obvious that $\text{F.softplus}(\text{log}(1-\beta)-\text{log}(\beta)) = \text{log}(1/\beta)$.</p>

<p>For $\text{F.softplus}(y) + \text{F.softplus}(-y)$, the reader can verify it is correct themselves or go through the next few lines.</p>

\[\text{F.softplus}(y) + \text{F.softplus}(-y)\\
=\text{F.softplus}\left( \text{log}\left( \frac{1+(2x-1)\beta}{1-(2x-1)\beta} \right) \right) + \text{F.softplus}\left(- \text{log}\left(\frac{1+(2x-1)\beta}{1-(2x-1)\beta} \right) \right)\\
=\text{log}\left( 1+\frac{1+(2x-1)\beta}{1-(2x-1)\beta} \right) + \text{log}\left( 1+\frac{1-(2x-1)\beta}{1+(2x-1)\beta} \right) \\
= \text{log}\left( \frac{2}{1-(2x-1)\beta} \right) + \text{log}\left( \frac{2}{1+(2x-1)\beta} \right) = \frac{\partial y}{\partial x} * \frac{1}{\beta}\]

<h1 id="real-nvp-model">Real NVP model</h1>

<h2 id="coupling-layer">Coupling Layer</h2>
<p>The very key component of Real NVP is the coupling layer, which is used to passing information while keep the sldj easy to compute. The original figure of coupling from the paper illustrates the forward and inverse operation of this coupling layer. In this coupling layer, the input $x$ is split into two $x_1$ and $x_2$ by channel, and then propagates according to this figure.
<img src="/images/blog/real_NVP/coupling-layer.png" alt="" /></p>

<p>Indeed, this figure is about the so called affine coupling layer (with scale and bias terms), where the functions $s$ and $t$ can be arbitrary complex neural networks (even attention module or with additional/conditional information injected).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># split x
</span><span class="n">x_change</span><span class="p">,</span> <span class="n">x_id</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">chunk</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">nn</span><span class="p">(</span><span class="n">x_id</span><span class="p">)</span>
<span class="c1"># apply the nn in a checkerboard manner
</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">st</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">...],</span> <span class="n">st</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">...]</span>
<span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">scale</span> <span class="o">*</span> <span class="n">torch</span><span class="p">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="c1"># Scale and translate
</span><span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
    <span class="n">x_change</span> <span class="o">=</span> <span class="n">x_change</span> <span class="o">*</span> <span class="n">s</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="n">exp</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span>
    <span class="c1"># track ldj
</span>    <span class="n">ldj</span> <span class="o">=</span> <span class="n">ldj</span> <span class="o">-</span> <span class="n">s</span><span class="p">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nb">sum</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">x_change</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_change</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span><span class="p">.</span><span class="n">exp</span><span class="p">()</span>
    <span class="c1"># track ldj
</span>    <span class="n">ldj</span> <span class="o">=</span> <span class="n">ldj</span> <span class="o">+</span> <span class="n">s</span><span class="p">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nb">sum</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># concatenate recover x
</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x_change</span><span class="p">,</span> <span class="n">x_id</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>This structure is invertible because $y_1=x_1$ is guaranteed for both forward and inverse propagation. On the other hand, this also means that the we can’t keep those channels unchanged all the time. One way to do so is to swap the position of $x_1$ and $x_2$ recursively like in the figure below. (in Glow model, the $1\times 1$ invertible convolution is introduced to better mitigate this issue.)</p>

<p><img src="/images/blog/real_NVP/alternating-pattern.png" alt="" /></p>

<h2 id="squeezing-and-masking">Squeezing and Masking</h2>
<p>Before the coupling layer, the checkerboard masking and squeezing is introduced, as shown in the following figure:
<img src="/images/blog/real_NVP/squeeze-mask.png" alt="" /></p>

<p>As you may get from this figure, each sub-channel after squeezing is just a scaled smaller image. This makes suer that $x_1$ and $x_2$ contain the information from the original image evenly.</p>

<p>According to the original paper: The squeezing operation reduces the $4 × 4 × 1$ tensor (on the left) into a $2 × 2 × 4$ tensor (on the right). Before the squeezing operation, a checkerboard pattern is used for coupling layers while a channel-wise masking pattern is used afterward.</p>

<p>These operations are both invertible because they are both linear operations.</p>

<h2 id="multi-scale-architecture">Multi-scale Architecture</h2>
<p>The squeeze operation mentioned above enable a multi-scale architecture used in the Real NVP, as shown in this picture. The main purpose of this architecture is to save computational resources (GPU memory etc.). When initializing the model, each scale is initialized recursively.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># recursively build real NVP scales 
</span><span class="k">if</span> <span class="n">num_scales</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="bp">self</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">_RealNVP</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="n">num_scales</span><span class="o">=</span><span class="n">num_scales</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>
<p><img src="/images/blog/real_NVP/multi-scale.png" alt="" /></p>

<p>As you can see in the figure, in each scale the size of the image is halved but with full connection to the next scale(information passing).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># split
</span><span class="n">x</span><span class="p">,</span> <span class="n">x_split</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">chunk</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">sldj</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">scale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sldj</span><span class="p">,</span> <span class="n">reverse</span><span class="p">)</span>
<span class="c1"># cat
</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">x_split</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>
<p>Every time after the squeeze, $x$ is split into $x$ and $x_{split}$, where $x$ will be processed in the following scale blocks and $x_{split}$ will remain unchanged. After $x$ is processed, it’s concatenated with $x_{split}$ to form the output with same size.</p>

                    </article>
                    <div class="share">
                        <div class="share-component"></div>
                    </div>
                    <div class="comment">
                        

  

  
        <div id="gitalk-container"></div>
        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
        <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
        <script>
        var gitalk = new Gitalk({
            id: '/2022/06/21/Real-NVP-Intro/',
            clientID: '7fdcca9624f082f2fd1e',
            clientSecret: '7408a6bc70b766c85f3eaff22433262e00c848e2',
            repo: 'yuanzhi-zhu',
            owner: 'yuanzhi-zhu',
            admin: ['yuanzhi-zhu'],
            labels: ['gitment'],
            perPage: 50,
        })
        gitalk.render('gitalk-container')
        </script>
  


                    </div>
                </div>
                <div class="column one-third">
                    
<h3>Search</h3>
<div id="site_search">
    <input type="text" id="search_box" placeholder="Search">
</div>

<ul id="search_results"></ul>

<link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/modules/sidebar-search.css">
<script src="http://localhost:4000/assets/js/simple-jekyll-search.min.js"></script>
<script src="http://localhost:4000/assets/js/search.js"></script>

<script type="text/javascript">
SimpleJekyllSearch({
    searchInput: document.getElementById('search_box'),
    resultsContainer: document.getElementById('search_results'),
    json: 'http://localhost:4000/assets/search_data.json',
    searchResultTemplate: '<li><a href="{url}" title="{desc}">{title}</a></li>',
    noResultsText: 'No results found',
    limit: 10,
    fuzzy: false,
    exclude: ['Welcome']
})
</script>
 
 <h3>My Popular Repositories</h3>



<a href="https://github.com/yuanzhi-zhu/ETH_PAI_MindMap" target="_blank" class="card text-center">
    <div class="thumbnail">
        <div class="card-image geopattern" data-pattern-id="ETH_PAI_MindMap">
            <div class="card-image-cell">
                <h3 class="card-title">
                    ETH_PAI_MindMap
                </h3>
            </div>
        </div>
        <div class="caption">
            <div class="card-description">
                <p class="card-text">Mind map for ETH course Probabilistic Artificial Intelligence(PAI) </p>
            </div>
            <div class="card-text">
                <span class="meta-info" title="4 stars">
                    <span class="octicon octicon-star"></span> 4
                </span>
                <span class="meta-info" title="0 forks">
                    <span class="octicon octicon-git-branch"></span> 0
                </span>
                <span class="meta-info" title="Last updated: 2022-05-13 15:58:43 UTC">
                    <span class="octicon octicon-clock"></span>
                    <time datetime="2022-05-13 15:58:43 UTC">2022-05-13</time>
                </span>
            </div>
        </div>
    </div>
</a>

<a href="https://github.com/yuanzhi-zhu/yuanzhi-zhu.github.io" target="_blank" class="card text-center">
    <div class="thumbnail">
        <div class="card-image geopattern" data-pattern-id="yuanzhi-zhu.github.io">
            <div class="card-image-cell">
                <h3 class="card-title">
                    yuanzhi-zhu.github.io
                </h3>
            </div>
        </div>
        <div class="caption">
            <div class="card-description">
                <p class="card-text">Personal blog</p>
            </div>
            <div class="card-text">
                <span class="meta-info" title="2 stars">
                    <span class="octicon octicon-star"></span> 2
                </span>
                <span class="meta-info" title="0 forks">
                    <span class="octicon octicon-git-branch"></span> 0
                </span>
                <span class="meta-info" title="Last updated: 2022-07-14 20:50:31 UTC">
                    <span class="octicon octicon-clock"></span>
                    <time datetime="2022-07-14 20:50:31 UTC">2022-07-14</time>
                </span>
            </div>
        </div>
    </div>
</a>

<a href="https://github.com/yuanzhi-zhu/CSNLP-Project-ETH" target="_blank" class="card text-center">
    <div class="thumbnail">
        <div class="card-image geopattern" data-pattern-id="CSNLP-Project-ETH">
            <div class="card-image-cell">
                <h3 class="card-title">
                    CSNLP-Project-ETH
                </h3>
            </div>
        </div>
        <div class="caption">
            <div class="card-description">
                <p class="card-text">This is the repo for our computational semantics natural language processing course project</p>
            </div>
            <div class="card-text">
                <span class="meta-info" title="1 stars">
                    <span class="octicon octicon-star"></span> 1
                </span>
                <span class="meta-info" title="0 forks">
                    <span class="octicon octicon-git-branch"></span> 0
                </span>
                <span class="meta-info" title="Last updated: 2022-07-15 19:11:18 UTC">
                    <span class="octicon octicon-clock"></span>
                    <time datetime="2022-07-15 19:11:18 UTC">2022-07-15</time>
                </span>
            </div>
        </div>
    </div>
</a>



                </div>
            -->
  <article class="article-content markdown-body has-jax has-jax has-jax">
    <p><strong>Prerequisite</strong>: Normalizing Flow</p>

<h1 id="overview">Overview</h1>

<p class=" has-jax has-jax"><strong>Normalizing Flow (NF)</strong> is a kind of generative model just like GANs and VAEs but provides injective mapping between data <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 0.919em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.754em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.418em, 1000.75em, 2.425em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math; font-style: italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.024em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">X</script> and latent variable <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-4" style="width: 0.919em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.754em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.418em, 1000.75em, 2.425em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-5"><span class="mi" id="MathJax-Span-6" style="font-family: MathJax_Math; font-style: italic;">Z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Z</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">Z</script>
 (from a simple distribution) with exact likelihood calculations. Among 
all the NFs, real NVP is one of the most important, which stands for 
real-valued non-volume preserving (real NVP) transformation, a set of 
powerful invertible and learnable transformations.</p>

<p class=" has-jax"><strong>Target</strong>: The goal here is to build a
 learnable, reversible transformation between a source domain 
(distribution) and a latent(simple distribution) domain <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-7" style="width: 0.919em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.754em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.418em, 1000.75em, 2.425em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-8"><span class="mi" id="MathJax-Span-9" style="font-family: MathJax_Math; font-style: italic;">Z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Z</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">Z</script> or another target domain. 
Just like most of the other NFs, we can train the real NVP by doing maximum likelihood estimation (MLE).</p>

<p>From now on we just consider the following situation: source domain 
is images of a style and target domain is Gaussian distribution.</p>

<p class=" has-jax has-jax has-jax has-jax has-jax has-jax has-jax has-jax">We need to first write the likelihood of source images <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-10" style="width: 3.128em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.694em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1002.6em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-11"><span class="msubsup" id="MathJax-Span-12"><span style="display: inline-block; position: relative; width: 1.18em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-13" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-14" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.017em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-15" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-16" style="font-family: MathJax_Math; font-style: italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.024em;"></span></span><span class="mo" id="MathJax-Span-17" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>X</mi></msub><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">p_X(X)</script> in a form that is easy to compute.
Given an image <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-18" style="width: 3.02em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.586em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.418em, 1002.59em, 2.465em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-19"><span class="mi" id="MathJax-Span-20" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-21" style="font-family: MathJax_Main; padding-left: 0.278em;">∈</span><span class="mi" id="MathJax-Span-22" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.024em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.109em; border-left: 0px solid; width: 0px; height: 0.964em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>∈</mo><mi>X</mi></math></span></span><script type="math/tex" id="MathJax-Element-5">x \in X</script>, a simple prior probability distribution <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;Z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-23" style="width: 1.242em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.078em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1001.08em, 2.619em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-24"><span class="msubsup" id="MathJax-Span-25"><span style="display: inline-block; position: relative; width: 1.089em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-26" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-27" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">Z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>Z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-6">p_Z</script> on a latent variable <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;Z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-28" style="width: 3.02em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.586em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.418em, 1002.59em, 2.465em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-29"><span class="mi" id="MathJax-Span-30" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-31" style="font-family: MathJax_Main; padding-left: 0.278em;">∈</span><span class="mi" id="MathJax-Span-32" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">Z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.109em; border-left: 0px solid; width: 0px; height: 0.964em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>∈</mo><mi>Z</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">z \in Z</script>, and a bijection <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;mi&gt;Z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-33" style="width: 4.906em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.203em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.396em, 1004.2em, 2.63em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-34"><span class="mi" id="MathJax-Span-35" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mo" id="MathJax-Span-36" style="font-family: MathJax_Main; padding-left: 0.278em;">:</span><span class="mi" id="MathJax-Span-37" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.024em;"></span></span><span class="mo" id="MathJax-Span-38" style="font-family: MathJax_Main; padding-left: 0.278em;">→</span><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">Z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 1.181em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo>:</mo><mi>X</mi><mo stretchy="false">→</mo><mi>Z</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">f : X \rightarrow Z</script> (with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-40" style="width: 4.205em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.61em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.267em, 1003.61em, 2.63em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-41"><span class="mi" id="MathJax-Span-42" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-43" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-44" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.597em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.55em, 4.354em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-45" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -4.35em; left: 0.618em;"><span class="texatom" id="MathJax-Span-46"><span class="mrow" id="MathJax-Span-47"><span class="mo" id="MathJax-Span-48" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-49" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 1.33em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi><mo>=</mo><msup><mi>f</mi><mrow class="MJX-TeXAtom-ORD"><mo>−</mo><mn>1</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-9">g = f^{−1}</script> ), the change of variable formula defines a model distribution on <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-50" style="width: 0.919em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.754em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.418em, 1000.75em, 2.425em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-51"><span class="mi" id="MathJax-Span-52" style="font-family: MathJax_Math; font-style: italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.024em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">X</script> by (as we assume <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;Z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-53" style="width: 1.242em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.078em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1001.08em, 2.619em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-54"><span class="msubsup" id="MathJax-Span-55"><span style="display: inline-block; position: relative; width: 1.089em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-56" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-57" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">Z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>Z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-11">p_Z</script> is Gaussian):</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;Z&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;|&lt;/mo&gt;&lt;mrow&gt;&lt;mtext&gt;det&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-58" style="width: 15.897em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.685em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(2.081em, 1013.57em, 4.854em, -1000em); top: -3.718em; left: 0em;"><span class="mrow" id="MathJax-Span-59"><span class="msubsup" id="MathJax-Span-60"><span style="display: inline-block; position: relative; width: 1.18em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-61" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-62" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.017em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-63" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-64" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-65" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-66" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-67" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.089em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-68" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-69" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">Z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-70" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-71" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mo" id="MathJax-Span-72" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-73" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-74" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-75" style="font-family: MathJax_Main;">)</span><span class="mrow" id="MathJax-Span-76" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-77" style="vertical-align: 1.475em;"><span style="display: inline-block; position: relative; width: 0.278em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.237em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -1.787em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -2.512em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mrow" id="MathJax-Span-78"><span class="mtext" id="MathJax-Span-79" style="font-family: MathJax_Main;">det</span><span class="mrow" id="MathJax-Span-80" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-81" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mfrac" id="MathJax-Span-82"><span style="display: inline-block; position: relative; width: 2.586em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.075em, 1002.37em, 4.399em, -1000em); top: -4.712em; left: 50%; margin-left: -1.233em;"><span class="mrow" id="MathJax-Span-83"><span class="mi" id="MathJax-Span-84" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-85" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mo" id="MathJax-Span-86" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-87" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-88" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.058em, 1001.71em, 4.171em, -1000em); top: -3.245em; left: 50%; margin-left: -0.855em;"><span class="mrow" id="MathJax-Span-89"><span class="mi" id="MathJax-Span-90" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-91"><span style="display: inline-block; position: relative; width: 1.145em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-92" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -4.276em; left: 0.572em;"><span class="mi" id="MathJax-Span-93" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1002.59em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.586em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-94" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span></span><span class="mo" id="MathJax-Span-95" style="vertical-align: 1.475em;"><span style="display: inline-block; position: relative; width: 0.278em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.237em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -1.787em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -2.512em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.718em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.193em; border-left: 0px solid; width: 0px; height: 2.966em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>p</mi><mi>X</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>p</mi><mi>Z</mi></msub><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mrow><mo>|</mo><mrow><mtext>det</mtext><mrow><mo>(</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>x</mi><mi>T</mi></msup></mrow></mfrac><mo>)</mo></mrow></mrow><mo>|</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-12">p_X(x) = p_Z(f(x))\left| \text{det}\left(\frac{\partial f(x)}{\partial x^T}\right)\right|</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;Z&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;|&lt;/mo&gt;&lt;mrow&gt;&lt;mtext&gt;det&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-96" style="width: 25.757em; display: inline-block;"><span style="display: inline-block; position: relative; width: 22.198em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(2.081em, 1021.99em, 4.854em, -1000em); top: -3.718em; left: 0em;"><span class="mrow" id="MathJax-Span-97"><span class="mtext" id="MathJax-Span-98" style="font-family: MathJax_Main;">log</span><span class="mo" id="MathJax-Span-99" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-100"><span style="display: inline-block; position: relative; width: 1.18em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-101" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-102" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.017em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-103" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-104" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-105" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-106" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-107" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mtext" id="MathJax-Span-108" style="font-family: MathJax_Main; padding-left: 0.278em;">log</span><span class="mrow" id="MathJax-Span-109" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-110" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-111"><span class="msubsup" id="MathJax-Span-112"><span style="display: inline-block; position: relative; width: 1.089em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-113" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-114" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">Z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-115" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-116" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mo" id="MathJax-Span-117" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-118" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-119" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-120" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-121" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-122" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mtext" id="MathJax-Span-123" style="font-family: MathJax_Main; padding-left: 0.222em;">log</span><span class="mrow" id="MathJax-Span-124" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-125" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mrow" id="MathJax-Span-126"><span class="mo" id="MathJax-Span-127" style="vertical-align: 1.475em;"><span style="display: inline-block; position: relative; width: 0.278em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.237em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -1.787em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -2.512em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mrow" id="MathJax-Span-128"><span class="mtext" id="MathJax-Span-129" style="font-family: MathJax_Main;">det</span><span class="mrow" id="MathJax-Span-130" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-131" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mfrac" id="MathJax-Span-132"><span style="display: inline-block; position: relative; width: 2.586em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.075em, 1002.37em, 4.399em, -1000em); top: -4.712em; left: 50%; margin-left: -1.233em;"><span class="mrow" id="MathJax-Span-133"><span class="mi" id="MathJax-Span-134" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-135" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mo" id="MathJax-Span-136" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-137" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-138" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.058em, 1001.71em, 4.171em, -1000em); top: -3.245em; left: 50%; margin-left: -0.855em;"><span class="mrow" id="MathJax-Span-139"><span class="mi" id="MathJax-Span-140" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-141"><span style="display: inline-block; position: relative; width: 1.145em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-142" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -4.276em; left: 0.572em;"><span class="mi" id="MathJax-Span-143" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1002.59em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.586em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-144" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span></span><span class="mo" id="MathJax-Span-145" style="vertical-align: 1.475em;"><span style="display: inline-block; position: relative; width: 0.278em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.237em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -1.787em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -2.512em; left: 0em;">∣<span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-146" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 3.718em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.193em; border-left: 0px solid; width: 0px; height: 2.966em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>log</mtext><mo stretchy="false">(</mo><msub><mi>p</mi><mi>X</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mtext>log</mtext><mrow><mo>(</mo><mrow><msub><mi>p</mi><mi>Z</mi></msub><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mo>)</mo></mrow><mo>+</mo><mtext>log</mtext><mrow><mo>(</mo><mrow><mo>|</mo><mrow><mtext>det</mtext><mrow><mo>(</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>x</mi><mi>T</mi></msup></mrow></mfrac><mo>)</mo></mrow></mrow><mo>|</mo></mrow><mo>)</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-13">\text{log}(p_X(x)) = \text{log}\left(p_Z(f(x))\right) + \text{log} \left( \left| \text{det}\left(\frac{\partial f(x)}{\partial x^T}\right)\right|\right)</script>

<p class=" has-jax has-jax has-jax">where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;Z&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-147" style="width: 4.259em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.664em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1003.57em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-148"><span class="msubsup" id="MathJax-Span-149"><span style="display: inline-block; position: relative; width: 1.089em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-150" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-151" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">Z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-152" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-153" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mo" id="MathJax-Span-154" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-155" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-156" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-157" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>Z</mi></msub><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-14">p_Z(f(x))</script> is easy to get given <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-158" style="width: 4.313em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.718em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1003.62em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-159"><span class="mi" id="MathJax-Span-160" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-161" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-162" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mo" id="MathJax-Span-163" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-164" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-165" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-15">z=f(x)</script>, <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2223;&lt;/mo&gt;&lt;mtext&gt;det&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2223;&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-166" style="width: 5.929em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.119em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(0.983em, 1005em, 2.894em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-167"><span class="mo" id="MathJax-Span-168" style="font-family: MathJax_Main;">∣</span><span class="mtext" id="MathJax-Span-169" style="font-family: MathJax_Main;">det</span><span class="mo" id="MathJax-Span-170" style="font-family: MathJax_Main;">(</span><span class="mfrac" id="MathJax-Span-171"><span style="display: inline-block; position: relative; width: 1.864em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.295em, 1001.68em, 4.325em, -1000em); top: -4.575em; left: 50%; margin-left: -0.872em;"><span class="mrow" id="MathJax-Span-172"><span class="mi" id="MathJax-Span-173" style="font-size: 70.7%; font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.025em;"></span></span><span class="mi" id="MathJax-Span-174" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.042em;"></span></span><span class="mo" id="MathJax-Span-175" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-176" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-177" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.283em, 1001.21em, 4.164em, -1000em); top: -3.533em; left: 50%; margin-left: -0.605em;"><span class="mrow" id="MathJax-Span-178"><span class="mi" id="MathJax-Span-179" style="font-size: 70.7%; font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.025em;"></span></span><span class="msubsup" id="MathJax-Span-180"><span style="display: inline-block; position: relative; width: 0.809em; height: 0px;"><span style="position: absolute; clip: rect(3.513em, 1000.37em, 4.156em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-181" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -4.191em; left: 0.404em;"><span class="mi" id="MathJax-Span-182" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1001.86em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.864em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-183" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-184" style="font-family: MathJax_Main;">∣</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.607em; border-left: 0px solid; width: 0px; height: 1.966em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">∣</mo><mtext>det</mtext><mo stretchy="false">(</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>x</mi><mi>T</mi></msup></mrow></mfrac><mo stretchy="false">)</mo><mo stretchy="false">∣</mo></math></span></span><script type="math/tex" id="MathJax-Element-16">\mid \text{det}(\frac{\partial f(x)}{\partial x^T})\mid</script> is the determinant of Jacobian, which can be construct to be computational efficient, too.</p>

<p class=" has-jax has-jax"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-185" style="width: 0.541em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.431em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.396em, 1000.43em, 2.63em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-186"><span class="mi" id="MathJax-Span-187" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 1.181em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math></span></span><script type="math/tex" id="MathJax-Element-17">f</script> can be decomposed to many invertible component: <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2218;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2218;&lt;/mo&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mo&gt;&amp;#x2218;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-188" style="width: 9.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.459em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.396em, 1008.46em, 2.63em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-189"><span class="mi" id="MathJax-Span-190" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span class="mo" id="MathJax-Span-191" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-192" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.919em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.55em, 4.354em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-193" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.49em;"><span class="mn" id="MathJax-Span-194" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-195" style="font-family: MathJax_Main; padding-left: 0.222em;">∘</span><span class="msubsup" id="MathJax-Span-196" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.919em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.55em, 4.354em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-197" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.49em;"><span class="mn" id="MathJax-Span-198" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-199" style="font-family: MathJax_Main; padding-left: 0.222em;">∘</span><span class="mo" id="MathJax-Span-200" style="font-family: MathJax_Main; padding-left: 0.222em;">…</span><span class="mo" id="MathJax-Span-201" style="font-family: MathJax_Main; padding-left: 0.222em;">∘</span><span class="msubsup" id="MathJax-Span-202" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.989em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.55em, 4.354em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-203" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.49em;"><span class="mi" id="MathJax-Span-204" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">n</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 1.181em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo>=</mo><msub><mi>f</mi><mn>1</mn></msub><mo>∘</mo><msub><mi>f</mi><mn>2</mn></msub><mo>∘</mo><mo>…</mo><mo>∘</mo><msub><mi>f</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-18">f = f_1 \circ f_2 \circ … \circ f_n</script> just like deep neural network.</p>

<p class=" has-jax">We describe here a batch of images as tensor of size <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;batch&lt;/mtext&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mtext&gt;size&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-205" style="width: 15.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.308em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1013.21em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-206"><span class="mtext" id="MathJax-Span-207" style="font-family: MathJax_Main;">batch</span><span class="mo" id="MathJax-Span-208" style="font-family: MathJax_Main;">.</span><span class="mtext" id="MathJax-Span-209" style="font-family: MathJax_Main; padding-left: 0.167em;">size</span><span class="mo" id="MathJax-Span-210" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-211" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-212" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-213" style="font-family: MathJax_Main; padding-left: 0.278em;">(</span><span class="mi" id="MathJax-Span-214" style="font-family: MathJax_Math; font-style: italic;">B</span><span class="mo" id="MathJax-Span-215" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-216" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span class="mo" id="MathJax-Span-217" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-218" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.057em;"></span></span><span class="mo" id="MathJax-Span-219" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-220" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.104em;"></span></span><span class="mo" id="MathJax-Span-221" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>batch</mtext><mo>.</mo><mtext>size</mtext><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>B</mi><mo>,</mo><mi>C</mi><mo>,</mo><mi>H</mi><mo>,</mo><mi>W</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-19">\text{batch}.\text{size}() = (B,C,H,W)</script>.</p>

<p class=" has-jax has-jax has-jax has-jax">For simplicity, we set batch_size <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-222" style="width: 3.182em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.748em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.418em, 1002.68em, 2.425em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-223"><span class="mi" id="MathJax-Span-224" style="font-family: MathJax_Math; font-style: italic;">B</span><span class="mo" id="MathJax-Span-225" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-226" style="font-family: MathJax_Main; padding-left: 0.278em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-20">B=1</script>. 
For any input image, we expect to get a latent variable <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x223C;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-227" style="width: 6.307em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.442em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1005.35em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-228"><span class="mi" id="MathJax-Span-229" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-230" style="font-family: MathJax_Main; padding-left: 0.278em;">∼</span><span class="mi" id="MathJax-Span-231" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span class="mo" id="MathJax-Span-232" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-233" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-234" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-235" style="font-family: MathJax_Main; padding-left: 0.167em;">1</span><span class="mo" id="MathJax-Span-236" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-21">z\sim N(0,1)</script>. In order to calculate <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-237" style="width: 4.744em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.095em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1004em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-238"><span class="mtext" id="MathJax-Span-239" style="font-family: MathJax_Main;">log</span><span class="msubsup" id="MathJax-Span-240"><span style="display: inline-block; position: relative; width: 1.18em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-241" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-242" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.017em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-243" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-244" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-245" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>log</mtext><msub><mi>p</mi><mi>X</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-22">\text{log} p_X(x)</script>, the model is also required to keep track the sum of log determinant of Jacobian (sldj) <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;J&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;det&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-246" style="width: 8.731em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.489em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(0.983em, 1007.49em, 2.894em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-247"><span class="mi" id="MathJax-Span-248" style="font-family: MathJax_Math; font-style: italic;">J<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.078em;"></span></span><span class="mo" id="MathJax-Span-249" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-250" style="font-family: MathJax_Main; padding-left: 0.278em;">log</span><span class="mo" id="MathJax-Span-251"></span><span class="mo" id="MathJax-Span-252" style="font-family: MathJax_Main; padding-left: 0.167em;">det</span><span class="mfrac" id="MathJax-Span-253" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.864em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.295em, 1001.68em, 4.325em, -1000em); top: -4.575em; left: 50%; margin-left: -0.872em;"><span class="mrow" id="MathJax-Span-254"><span class="mi" id="MathJax-Span-255" style="font-size: 70.7%; font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.025em;"></span></span><span class="mi" id="MathJax-Span-256" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.042em;"></span></span><span class="mo" id="MathJax-Span-257" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-258" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-259" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.283em, 1001.21em, 4.164em, -1000em); top: -3.533em; left: 50%; margin-left: -0.605em;"><span class="mrow" id="MathJax-Span-260"><span class="mi" id="MathJax-Span-261" style="font-size: 70.7%; font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.025em;"></span></span><span class="msubsup" id="MathJax-Span-262"><span style="display: inline-block; position: relative; width: 0.809em; height: 0px;"><span style="position: absolute; clip: rect(3.513em, 1000.37em, 4.156em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-263" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -4.191em; left: 0.404em;"><span class="mi" id="MathJax-Span-264" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1001.86em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.864em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.607em; border-left: 0px solid; width: 0px; height: 1.966em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>J</mi><mo>=</mo><mi>log</mi><mo>⁡</mo><mo movablelimits="true" form="prefix">det</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>x</mi><mi>T</mi></msup></mrow></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-23">J = \log \det \frac{\partial f(x)}{\partial x^T}</script>.</p>

<h1 id="pre-process">Pre-process</h1>

<p class=" has-jax">We further assume the value of each element in this tensor <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-265" style="width: 4.151em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.556em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1003.44em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-266"><span class="mo" id="MathJax-Span-267" style="font-family: MathJax_Main;">∈</span><span class="mo" id="MathJax-Span-268" style="font-family: MathJax_Main; padding-left: 0.278em;">[</span><span class="mn" id="MathJax-Span-269" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-270" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-271" style="font-family: MathJax_Main; padding-left: 0.167em;">1</span><span class="mo" id="MathJax-Span-272" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-24">\in [0,1]</script>.</p>

<p>The next step is to de-quantize these images, to make the values a 
continues distribution. (Since the discrete data distribution has 
differential entropy of negative infinity, this can lead to arbitrary 
high likelihoods even on test data. To avoid this case, it is becoming 
best practice to add real-valued noise to the integer pixel values to 
de-quantize the data):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mf">255.</span> <span class="o">+</span> <span class="n">torch</span><span class="p">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="mf">256.</span>      <span class="c1"># [0,1] with noise
</span></code></pre></div></div>
<p class=" has-jax">Notice: now for the same input images, the model will give each time slightly different <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;Z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-273" style="width: 3.02em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.586em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.418em, 1002.59em, 2.465em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-274"><span class="mi" id="MathJax-Span-275" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-276" style="font-family: MathJax_Main; padding-left: 0.278em;">∈</span><span class="mi" id="MathJax-Span-277" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">Z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.109em; border-left: 0px solid; width: 0px; height: 0.964em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>∈</mo><mi>Z</mi></math></span></span><script type="math/tex" id="MathJax-Element-25">z\in Z</script>.</p>

<p>According to https://arxiv.org/abs/1605.08803, Section 4.1, we will model logits:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">log</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span><span class="p">).</span><span class="n">log</span><span class="p">()</span>            
</code></pre></div></div>
<p class=" has-jax has-jax has-jax">Since <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-278" style="width: 5.121em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.418em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1004.3em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-279"><span class="mi" id="MathJax-Span-280" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-281" style="font-family: MathJax_Main; padding-left: 0.278em;">∈</span><span class="mo" id="MathJax-Span-282" style="font-family: MathJax_Main; padding-left: 0.278em;">[</span><span class="mn" id="MathJax-Span-283" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-284" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-285" style="font-family: MathJax_Main; padding-left: 0.167em;">1</span><span class="mo" id="MathJax-Span-286" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-26">x\in [0,1]</script>, it’s dangerous to apply directly log to them, so we apply a data_constraint <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.9&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-287" style="width: 4.151em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.556em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.396em, 1003.51em, 2.619em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-288"><span class="mi" id="MathJax-Span-289" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span><span class="mo" id="MathJax-Span-290" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-291" style="font-family: MathJax_Main; padding-left: 0.278em;">0.9</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 1.168em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi><mo>=</mo><mn>0.9</mn></math></span></span><script type="math/tex" id="MathJax-Element-27">\beta=0.9</script> to <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-292" style="width: 0.649em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1000.49em, 2.436em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-293"><span class="mi" id="MathJax-Span-294" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-28">x</script>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Convert to logits
</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_constraint</span>  <span class="c1"># [-0.9, 0.9]
</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>                         <span class="c1"># [0.05, 0.95]
</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">.</span><span class="n">log</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">y</span><span class="p">).</span><span class="n">log</span><span class="p">()</span>            <span class="c1"># logit: y=log((((2x-1)beta+1)/2)/(1-((2x-1)beta+1)/2))          
</span></code></pre></div></div>

<p>Now let compute the sldj of pre-process step.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Save log-determinant of Jacobian of initial transform
# Softplus(x) = 1/beta*log(1+exp(beta*x)) (default beta=1) element-wise: activation function
</span><span class="n">ldj</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="n">softplus</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="p">.</span><span class="n">softplus</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span> \
    <span class="o">-</span> <span class="n">F</span><span class="p">.</span><span class="n">softplus</span><span class="p">((</span><span class="mf">1.</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_constraint</span><span class="p">).</span><span class="n">log</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">data_constraint</span><span class="p">.</span><span class="n">log</span><span class="p">())</span>
<span class="c1"># sum up pixels and channels of every in each batch
</span><span class="n">ldj</span> <span class="o">=</span> <span class="n">ldj</span><span class="p">.</span><span class="n">view</span><span class="p">(</span><span class="n">ldj</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nb">sum</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p class=" has-jax has-jax">As commented above, <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;F.softplus&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-295" style="width: 14.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.823em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1012.73em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-296"><span class="mtext" id="MathJax-Span-297" style="font-family: MathJax_Main;">F.softplus</span><span class="mo" id="MathJax-Span-298" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-299" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-300" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-301" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mtext" id="MathJax-Span-302" style="font-family: MathJax_Main; padding-left: 0.278em;">log</span><span class="mo" id="MathJax-Span-303" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-304" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-305" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-306" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.43em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-307" style="font-family: MathJax_Math; font-style: italic;">e</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -4.35em; left: 0.466em;"><span class="texatom" id="MathJax-Span-308"><span class="mrow" id="MathJax-Span-309"><span class="mi" id="MathJax-Span-310" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-311" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>F.softplus</mtext><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>log</mtext><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi></mrow></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-29">\text{F.softplus}(x) = \text{log}(1+e^{x})</script>, and it’s obvious that <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;F.softplus&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-312" style="width: 23.225em; display: inline-block;"><span style="display: inline-block; position: relative; width: 19.989em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1019.89em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-313"><span class="mtext" id="MathJax-Span-314" style="font-family: MathJax_Main;">F.softplus</span><span class="mo" id="MathJax-Span-315" style="font-family: MathJax_Main;">(</span><span class="mtext" id="MathJax-Span-316" style="font-family: MathJax_Main;">log</span><span class="mo" id="MathJax-Span-317" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-318" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-319" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-320" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span><span class="mo" id="MathJax-Span-321" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-322" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mtext" id="MathJax-Span-323" style="font-family: MathJax_Main; padding-left: 0.222em;">log</span><span class="mo" id="MathJax-Span-324" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-325" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span><span class="mo" id="MathJax-Span-326" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-327" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-328" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mtext" id="MathJax-Span-329" style="font-family: MathJax_Main; padding-left: 0.278em;">log</span><span class="mo" id="MathJax-Span-330" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-331" style="font-family: MathJax_Main;">1</span><span class="texatom" id="MathJax-Span-332"><span class="mrow" id="MathJax-Span-333"><span class="mo" id="MathJax-Span-334" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-335" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span><span class="mo" id="MathJax-Span-336" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>F.softplus</mtext><mo stretchy="false">(</mo><mtext>log</mtext><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>β</mi><mo stretchy="false">)</mo><mo>−</mo><mtext>log</mtext><mo stretchy="false">(</mo><mi>β</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mtext>log</mtext><mo stretchy="false">(</mo><mn>1</mn><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mi>β</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-30">\text{F.softplus}(\text{log}(1-\beta)-\text{log}(\beta)) = \text{log}(1/\beta)</script>.</p>

<p class=" has-jax">For <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;F.softplus&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mtext&gt;F.softplus&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-337" style="width: 16.867em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.547em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1014.45em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-338"><span class="mtext" id="MathJax-Span-339" style="font-family: MathJax_Main;">F.softplus</span><span class="mo" id="MathJax-Span-340" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-341" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-342" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-343" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mtext" id="MathJax-Span-344" style="font-family: MathJax_Main; padding-left: 0.222em;">F.softplus</span><span class="mo" id="MathJax-Span-345" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-346" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-347" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-348" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>F.softplus</mtext><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mo>+</mo><mtext>F.softplus</mtext><mo stretchy="false">(</mo><mo>−</mo><mi>y</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-31">\text{F.softplus}(y) + \text{F.softplus}(-y)</script>, the reader can verify it is correct themselves or go through the next few lines.</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display"><span class="MathJax MathJax_FullWidth" id="MathJax-Element-32-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtext&gt;F.softplus&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mtext&gt;F.softplus&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mspace linebreak=&quot;newline&quot; /&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;F.softplus&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mtext&gt;F.softplus&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mspace linebreak=&quot;newline&quot; /&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mspace linebreak=&quot;newline&quot; /&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mtext&gt;log&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-349" style="width: 100%; display: inline-block; min-width: 38.58em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(9.703em, 1033.02em, 19.641em, -1000em); top: -10.614em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-350"><span style="display: inline-block; position: relative; width: 100%; height: 0px;"><span style="position: absolute; clip: rect(3.075em, 1013.06em, 4.399em, -1000em); top: -3.987em; left: 50%; margin-left: -6.578em;"><span class="mtext" id="MathJax-Span-351" style="font-family: MathJax_Main;">F.softplus</span><span class="mo" id="MathJax-Span-352" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-353" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-354" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-355" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mtext" id="MathJax-Span-356" style="font-family: MathJax_Main; padding-left: 0.222em;">F.softplus</span><span class="mo" id="MathJax-Span-357" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-358" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-359" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-360" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(2.351em, 1033.02em, 5.123em, -1000em); top: -1.832em; left: 50%; margin-left: -16.615em;"><span class="mspace" id="MathJax-Span-361" style="height: 0em; vertical-align: 0em; width: 0em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-362" style="font-family: MathJax_Main;">=</span><span class="mtext" id="MathJax-Span-363" style="font-family: MathJax_Main; padding-left: 0.278em;">F.softplus</span><span class="mrow" id="MathJax-Span-364" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-365" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mrow" id="MathJax-Span-366"><span class="mtext" id="MathJax-Span-367" style="font-family: MathJax_Main;">log</span><span class="mrow" id="MathJax-Span-368" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-369" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mfrac" id="MathJax-Span-370"><span style="display: inline-block; position: relative; width: 5.987em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.075em, 1005.87em, 4.399em, -1000em); top: -4.712em; left: 50%; margin-left: -2.934em;"><span class="mrow" id="MathJax-Span-371"><span class="mn" id="MathJax-Span-372" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-373" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-374" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-375" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-376" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-377" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-378" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-379" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-380" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.075em, 1005.87em, 4.399em, -1000em); top: -3.262em; left: 50%; margin-left: -2.934em;"><span class="mrow" id="MathJax-Span-381"><span class="mn" id="MathJax-Span-382" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-383" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mo" id="MathJax-Span-384" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-385" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-386" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-387" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-388" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-389" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-390" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1005.99em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.987em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-391" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span></span><span class="mo" id="MathJax-Span-392" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span><span class="mo" id="MathJax-Span-393" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mtext" id="MathJax-Span-394" style="font-family: MathJax_Main; padding-left: 0.222em;">F.softplus</span><span class="mrow" id="MathJax-Span-395" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-396" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mrow" id="MathJax-Span-397"><span class="mo" id="MathJax-Span-398" style="font-family: MathJax_Main;">−</span><span class="mtext" id="MathJax-Span-399" style="font-family: MathJax_Main;">log</span><span class="mrow" id="MathJax-Span-400" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-401" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mfrac" id="MathJax-Span-402"><span style="display: inline-block; position: relative; width: 5.987em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.075em, 1005.87em, 4.399em, -1000em); top: -4.712em; left: 50%; margin-left: -2.934em;"><span class="mrow" id="MathJax-Span-403"><span class="mn" id="MathJax-Span-404" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-405" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-406" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-407" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-408" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-409" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-410" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-411" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-412" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.075em, 1005.87em, 4.399em, -1000em); top: -3.262em; left: 50%; margin-left: -2.934em;"><span class="mrow" id="MathJax-Span-413"><span class="mn" id="MathJax-Span-414" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-415" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mo" id="MathJax-Span-416" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-417" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-418" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-419" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-420" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-421" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-422" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1005.99em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.987em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-423" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span></span><span class="mo" id="MathJax-Span-424" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(2.351em, 1023.8em, 5.123em, -1000em); top: 1.048em; left: 50%; margin-left: -12.005em;"><span class="mspace" id="MathJax-Span-425" style="height: 0em; vertical-align: 0em; width: 0em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-426" style="font-family: MathJax_Main;">=</span><span class="mtext" id="MathJax-Span-427" style="font-family: MathJax_Main; padding-left: 0.278em;">log</span><span class="mrow" id="MathJax-Span-428" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-429" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mrow" id="MathJax-Span-430"><span class="mn" id="MathJax-Span-431" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-432" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mfrac" id="MathJax-Span-433" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 5.987em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.075em, 1005.87em, 4.399em, -1000em); top: -4.712em; left: 50%; margin-left: -2.934em;"><span class="mrow" id="MathJax-Span-434"><span class="mn" id="MathJax-Span-435" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-436" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-437" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-438" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-439" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-440" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-441" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-442" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-443" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.075em, 1005.87em, 4.399em, -1000em); top: -3.262em; left: 50%; margin-left: -2.934em;"><span class="mrow" id="MathJax-Span-444"><span class="mn" id="MathJax-Span-445" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-446" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mo" id="MathJax-Span-447" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-448" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-449" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-450" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-451" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-452" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-453" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1005.99em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.987em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-454" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span><span class="mo" id="MathJax-Span-455" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mtext" id="MathJax-Span-456" style="font-family: MathJax_Main; padding-left: 0.222em;">log</span><span class="mrow" id="MathJax-Span-457" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-458" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mrow" id="MathJax-Span-459"><span class="mn" id="MathJax-Span-460" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-461" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mfrac" id="MathJax-Span-462" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 5.987em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.075em, 1005.87em, 4.399em, -1000em); top: -4.712em; left: 50%; margin-left: -2.934em;"><span class="mrow" id="MathJax-Span-463"><span class="mn" id="MathJax-Span-464" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-465" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mo" id="MathJax-Span-466" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-467" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-468" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-469" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-470" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-471" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-472" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.075em, 1005.87em, 4.399em, -1000em); top: -3.262em; left: 50%; margin-left: -2.934em;"><span class="mrow" id="MathJax-Span-473"><span class="mn" id="MathJax-Span-474" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-475" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-476" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-477" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-478" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-479" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-480" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-481" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-482" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1005.99em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.987em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-483" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(2.376em, 1025.28em, 5.123em, -1000em); top: 3.903em; left: 50%; margin-left: -12.638em;"><span class="mspace" id="MathJax-Span-484" style="height: 0em; vertical-align: 0em; width: 0em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-485" style="font-family: MathJax_Main;">=</span><span class="mtext" id="MathJax-Span-486" style="font-family: MathJax_Main; padding-left: 0.278em;">log</span><span class="mrow" id="MathJax-Span-487" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-488" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mfrac" id="MathJax-Span-489"><span style="display: inline-block; position: relative; width: 5.987em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.159em, 1000.45em, 4.149em, -1000em); top: -4.664em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-490" style="font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.075em, 1005.87em, 4.399em, -1000em); top: -3.262em; left: 50%; margin-left: -2.934em;"><span class="mrow" id="MathJax-Span-491"><span class="mn" id="MathJax-Span-492" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-493" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mo" id="MathJax-Span-494" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-495" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-496" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-497" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-498" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-499" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-500" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1005.99em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.987em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-501" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span><span class="mo" id="MathJax-Span-502" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mtext" id="MathJax-Span-503" style="font-family: MathJax_Main; padding-left: 0.222em;">log</span><span class="mrow" id="MathJax-Span-504" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-505" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mfrac" id="MathJax-Span-506"><span style="display: inline-block; position: relative; width: 5.987em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.159em, 1000.45em, 4.149em, -1000em); top: -4.664em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-507" style="font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.075em, 1005.87em, 4.399em, -1000em); top: -3.262em; left: 50%; margin-left: -2.934em;"><span class="mrow" id="MathJax-Span-508"><span class="mn" id="MathJax-Span-509" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-510" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-511" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-512" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-513" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-514" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-515" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-516" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-517" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1005.99em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.987em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-518" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span><span class="mo" id="MathJax-Span-519" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mfrac" id="MathJax-Span-520" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.258em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.11em, 1001.06em, 4.354em, -1000em); top: -4.667em; left: 50%; margin-left: -0.531em;"><span class="mrow" id="MathJax-Span-521"><span class="mi" id="MathJax-Span-522" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-523" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.11em, 1001.09em, 4.171em, -1000em); top: -3.297em; left: 50%; margin-left: -0.569em;"><span class="mrow" id="MathJax-Span-524"><span class="mi" id="MathJax-Span-525" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-526" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1001.26em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.258em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-527" style="font-family: MathJax_Main; padding-left: 0.222em;">∗</span><span class="mfrac" id="MathJax-Span-528" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.693em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.159em, 1000.43em, 4.149em, -1000em); top: -4.664em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-529" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.12em, 1000.57em, 4.343em, -1000em); top: -3.301em; left: 50%; margin-left: -0.286em;"><span class="mi" id="MathJax-Span-530" style="font-family: MathJax_Math; font-style: italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(0.849em, 1000.69em, 1.239em, -1000em); top: -1.298em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.693em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 10.614em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -10.345em; border-left: 0px solid; width: 0px; height: 11.278em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>F.softplus</mtext><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mo>+</mo><mtext>F.softplus</mtext><mo stretchy="false">(</mo><mo>−</mo><mi>y</mi><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mo>=</mo><mtext>F.softplus</mtext><mrow><mo>(</mo><mrow><mtext>log</mtext><mrow><mo>(</mo><mfrac><mrow><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>β</mi></mrow><mrow><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>β</mi></mrow></mfrac><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>+</mo><mtext>F.softplus</mtext><mrow><mo>(</mo><mrow><mo>−</mo><mtext>log</mtext><mrow><mo>(</mo><mfrac><mrow><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>β</mi></mrow><mrow><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>β</mi></mrow></mfrac><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mspace linebreak="newline"></mspace><mo>=</mo><mtext>log</mtext><mrow><mo>(</mo><mrow><mn>1</mn><mo>+</mo><mfrac><mrow><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>β</mi></mrow><mrow><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>β</mi></mrow></mfrac></mrow><mo>)</mo></mrow><mo>+</mo><mtext>log</mtext><mrow><mo>(</mo><mrow><mn>1</mn><mo>+</mo><mfrac><mrow><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>β</mi></mrow><mrow><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>β</mi></mrow></mfrac></mrow><mo>)</mo></mrow><mspace linebreak="newline"></mspace><mo>=</mo><mtext>log</mtext><mrow><mo>(</mo><mfrac><mn>2</mn><mrow><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>β</mi></mrow></mfrac><mo>)</mo></mrow><mo>+</mo><mtext>log</mtext><mrow><mo>(</mo><mfrac><mn>2</mn><mrow><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>β</mi></mrow></mfrac><mo>)</mo></mrow><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>y</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>x</mi></mrow></mfrac><mo>∗</mo><mfrac><mn>1</mn><mi>β</mi></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-32">\text{F.softplus}(y) + \text{F.softplus}(-y)\\
=\text{F.softplus}\left( \text{log}\left( \frac{1+(2x-1)\beta}{1-(2x-1)\beta} \right) \right) + \text{F.softplus}\left(- \text{log}\left(\frac{1+(2x-1)\beta}{1-(2x-1)\beta} \right) \right)\\
=\text{log}\left( 1+\frac{1+(2x-1)\beta}{1-(2x-1)\beta} \right) + \text{log}\left( 1+\frac{1-(2x-1)\beta}{1+(2x-1)\beta} \right) \\
= \text{log}\left( \frac{2}{1-(2x-1)\beta} \right) + \text{log}\left( \frac{2}{1+(2x-1)\beta} \right) = \frac{\partial y}{\partial x} * \frac{1}{\beta}</script>

<h1 id="real-nvp-model">Real NVP model</h1>

<h2 id="coupling-layer">Coupling Layer</h2>
<p class=" has-jax has-jax has-jax">The very key component of Real NVP 
is the coupling layer, which is used to passing information while keep 
the sldj easy to compute. The original figure of coupling from the paper
 illustrates the forward and inverse operation of this coupling layer. 
In this coupling layer, the input <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-531" style="width: 0.649em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1000.49em, 2.436em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-532"><span class="mi" id="MathJax-Span-533" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-33">x</script> is split into two <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-534" style="width: 1.188em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.024em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1001.02em, 2.575em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-535"><span class="msubsup" id="MathJax-Span-536"><span style="display: inline-block; position: relative; width: 1.001em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-537" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="mn" id="MathJax-Span-538" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.236em; border-left: 0px solid; width: 0px; height: 0.812em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-34">x_1</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-539" style="width: 1.188em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.024em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1001.02em, 2.575em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-540"><span class="msubsup" id="MathJax-Span-541"><span style="display: inline-block; position: relative; width: 1.001em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-542" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="mn" id="MathJax-Span-543" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.236em; border-left: 0px solid; width: 0px; height: 0.812em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-35">x_2</script> by channel, and then propagates according to this figure.
<img src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/coupling-layer.png" alt=""></p>

<p class=" has-jax has-jax">Indeed, this figure is about the so called affine coupling layer (with scale and bias terms), where the functions <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-544" style="width: 0.649em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1000.49em, 2.435em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-545"><span class="mi" id="MathJax-Span-546" style="font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.074em; border-left: 0px solid; width: 0px; height: 0.649em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-36">s</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-547" style="width: 0.434em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.377em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.475em, 1000.35em, 2.436em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-548"><span class="mi" id="MathJax-Span-549" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.864em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-37">t</script> can be arbitrary complex neural networks (even attention module or with additional/conditional information injected).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># split x
</span><span class="n">x_change</span><span class="p">,</span> <span class="n">x_id</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">chunk</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">nn</span><span class="p">(</span><span class="n">x_id</span><span class="p">)</span>
<span class="c1"># apply the nn in a checkerboard manner
</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">st</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">...],</span> <span class="n">st</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">...]</span>
<span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">scale</span> <span class="o">*</span> <span class="n">torch</span><span class="p">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="c1"># Scale and translate
</span><span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
    <span class="n">x_change</span> <span class="o">=</span> <span class="n">x_change</span> <span class="o">*</span> <span class="n">s</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="n">exp</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span>
    <span class="c1"># track ldj
</span>    <span class="n">ldj</span> <span class="o">=</span> <span class="n">ldj</span> <span class="o">-</span> <span class="n">s</span><span class="p">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nb">sum</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">x_change</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_change</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span><span class="p">.</span><span class="n">exp</span><span class="p">()</span>
    <span class="c1"># track ldj
</span>    <span class="n">ldj</span> <span class="o">=</span> <span class="n">ldj</span> <span class="o">+</span> <span class="n">s</span><span class="p">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nb">sum</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># concatenate recover x
</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x_change</span><span class="p">,</span> <span class="n">x_id</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p class=" has-jax has-jax has-jax has-jax">This structure is invertible because <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-550" style="width: 3.882em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.341em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1003.34em, 2.63em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-551"><span class="msubsup" id="MathJax-Span-552"><span style="display: inline-block; position: relative; width: 0.919em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.354em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-553" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.49em;"><span class="mn" id="MathJax-Span-554" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-555" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-556" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.001em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-557" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="mn" id="MathJax-Span-558" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.876em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>y</mi><mn>1</mn></msub><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-38">y_1=x_1</script>
 is guaranteed for both forward and inverse propagation. On the other 
hand, this also means that the we can’t keep those channels unchanged 
all the time. One way to do so is to swap the position of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-559" style="width: 1.188em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.024em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1001.02em, 2.575em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-560"><span class="msubsup" id="MathJax-Span-561"><span style="display: inline-block; position: relative; width: 1.001em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-562" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="mn" id="MathJax-Span-563" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.236em; border-left: 0px solid; width: 0px; height: 0.812em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-39">x_1</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-564" style="width: 1.188em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.024em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1001.02em, 2.575em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-565"><span class="msubsup" id="MathJax-Span-566"><span style="display: inline-block; position: relative; width: 1.001em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-567" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="mn" id="MathJax-Span-568" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.236em; border-left: 0px solid; width: 0px; height: 0.812em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-40">x_2</script> recursively like in the figure below. (in Glow model, the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-569" style="width: 2.966em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.532em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.435em, 1002.46em, 2.425em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-570"><span class="mn" id="MathJax-Span-571" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-572" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="mn" id="MathJax-Span-573" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.898em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>×</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-41">1\times 1</script> invertible convolution is introduced to better mitigate this issue.)</p>

<p><img src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/alternating-pattern.png" alt=""></p>

<h2 id="squeezing-and-masking">Squeezing and Masking</h2>
<p>Before the coupling layer, the checkerboard masking and squeezing is introduced, as shown in the following figure:
<img src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/squeeze-mask.png" alt=""></p>

<p class=" has-jax has-jax">As you may get from this figure, each sub-channel after squeezing is just a scaled smaller image. This makes suer that <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-574" style="width: 1.188em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.024em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1001.02em, 2.575em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-575"><span class="msubsup" id="MathJax-Span-576"><span style="display: inline-block; position: relative; width: 1.001em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-577" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="mn" id="MathJax-Span-578" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.236em; border-left: 0px solid; width: 0px; height: 0.812em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-42">x_1</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-579" style="width: 1.188em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.024em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1001.02em, 2.575em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-580"><span class="msubsup" id="MathJax-Span-581"><span style="display: inline-block; position: relative; width: 1.001em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-582" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="mn" id="MathJax-Span-583" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.236em; border-left: 0px solid; width: 0px; height: 0.812em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-43">x_2</script> contain the information from the original image evenly.</p>

<p class=" has-jax has-jax">According to the original paper: The squeezing operation reduces the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-584" style="width: 5.229em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.472em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.424em, 1004.4em, 2.425em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-585"><span class="mn" id="MathJax-Span-586" style="font-family: MathJax_Main;">4</span><span class="mo" id="MathJax-Span-587" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="mn" id="MathJax-Span-588" style="font-family: MathJax_Main; padding-left: 0.222em;">4</span><span class="mo" id="MathJax-Span-589" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="mn" id="MathJax-Span-590" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.91em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mo>×</mo><mn>4</mn><mo>×</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-44">4 × 4 × 1</script> tensor (on the left) into a <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-591" style="width: 5.229em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.472em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.424em, 1004.44em, 2.425em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-592"><span class="mn" id="MathJax-Span-593" style="font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-594" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="mn" id="MathJax-Span-595" style="font-family: MathJax_Main; padding-left: 0.222em;">2</span><span class="mo" id="MathJax-Span-596" style="font-family: MathJax_Main; padding-left: 0.222em;">×</span><span class="mn" id="MathJax-Span-597" style="font-family: MathJax_Main; padding-left: 0.222em;">4</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.91em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mo>×</mo><mn>2</mn><mo>×</mo><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-45">2 × 2 × 4</script>
 tensor (on the right). Before the squeezing operation, a checkerboard 
pattern is used for coupling layers while a channel-wise masking pattern
 is used afterward.</p>

<p>These operations are both invertible because they are both linear operations.</p>

<h2 id="multi-scale-architecture">Multi-scale Architecture</h2>
<p>The squeeze operation mentioned above enable a multi-scale 
architecture used in the Real NVP, as shown in this picture. The main 
purpose of this architecture is to save computational resources (GPU 
memory etc.). When initializing the model, each scale is initialized 
recursively.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># recursively build real NVP scales 
</span><span class="k">if</span> <span class="n">num_scales</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="bp">self</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">_RealNVP</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="n">num_scales</span><span class="o">=</span><span class="n">num_scales</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>
<p><img src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/multi-scale.png" alt=""></p>

<p>As you can see in the figure, in each scale the size of the image is 
halved but with full connection to the next scale(information passing).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># split
</span><span class="n">x</span><span class="p">,</span> <span class="n">x_split</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">chunk</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">sldj</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">scale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sldj</span><span class="p">,</span> <span class="n">reverse</span><span class="p">)</span>
<span class="c1"># cat
</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">x_split</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>
<p class=" has-jax has-jax has-jax has-jax has-jax has-jax has-jax">Every time after the squeeze, <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-598" style="width: 0.649em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1000.49em, 2.436em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-599"><span class="mi" id="MathJax-Span-600" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-46">x</script> is split into <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-601" style="width: 0.649em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1000.49em, 2.436em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-602"><span class="mi" id="MathJax-Span-603" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-47">x</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-604" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1002.05em, 2.712em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-605"><span class="msubsup" id="MathJax-Span-606"><span style="display: inline-block; position: relative; width: 2.044em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-607" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="texatom" id="MathJax-Span-608"><span class="mrow" id="MathJax-Span-609"><span class="mi" id="MathJax-Span-610" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">s</span><span class="mi" id="MathJax-Span-611" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-612" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">l</span><span class="mi" id="MathJax-Span-613" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-614" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.396em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>t</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-48">x_{split}</script>, where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-615" style="width: 0.649em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1000.49em, 2.436em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-616"><span class="mi" id="MathJax-Span-617" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-49">x</script> will be processed in the following scale blocks and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-618" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1002.05em, 2.712em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-619"><span class="msubsup" id="MathJax-Span-620"><span style="display: inline-block; position: relative; width: 2.044em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-621" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="texatom" id="MathJax-Span-622"><span class="mrow" id="MathJax-Span-623"><span class="mi" id="MathJax-Span-624" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">s</span><span class="mi" id="MathJax-Span-625" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-626" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">l</span><span class="mi" id="MathJax-Span-627" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-628" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.396em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>t</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-50">x_{split}</script> will remain unchanged. After <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-629" style="width: 0.649em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1000.49em, 2.436em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-630"><span class="mi" id="MathJax-Span-631" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-51">x</script> is processed, it’s concatenated with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-632" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1002.05em, 2.712em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-633"><span class="msubsup" id="MathJax-Span-634"><span style="display: inline-block; position: relative; width: 2.044em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-635" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="texatom" id="MathJax-Span-636"><span class="mrow" id="MathJax-Span-637"><span class="mi" id="MathJax-Span-638" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">s</span><span class="mi" id="MathJax-Span-639" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-640" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">l</span><span class="mi" id="MathJax-Span-641" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span class="mi" id="MathJax-Span-642" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.396em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>t</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-52">x_{split}</script> to form the output with same size.</p>

  </article>
  <div class="comment">
    

  

  
        <div id="gitalk-container"><div class="gt-container"><div class="gt-meta"><span class="gt-counts"><a class="gt-link gt-link-counts" href="http://localhost:4000/2022/06/21/Real-NVP-Intro/null" target="_blank" rel="noopener noreferrer">0</a> comments</span><div class="gt-user"><div class="gt-user-inner"><span class="gt-user-name">Anonymous</span><span class="gt-ico gt-ico-arrdown"><span class="gt-svg"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1619"><path d="M511.872 676.8c-0.003 0-0.006 0-0.008 0-9.137 0-17.379-3.829-23.21-9.97l-251.277-265.614c-5.415-5.72-8.743-13.464-8.744-21.984 0-17.678 14.33-32.008 32.008-32.008 9.157 0 17.416 3.845 23.25 10.009l228.045 241.103 228.224-241.088c5.855-6.165 14.113-10.001 23.266-10.001 8.516 0 16.256 3.32 21.998 8.736 12.784 12.145 13.36 32.434 1.264 45.233l-251.52 265.6c-5.844 6.155-14.086 9.984-23.223 9.984-0.025 0-0.051 0-0.076 0z" p-id="1620"></path></svg></span></span></div></div></div><div class="gt-error">Error: Not Found. </div><div class="gt-header"><a class="gt-avatar-github"><span class="gt-ico gt-ico-github"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64 524C64 719.602 189.356 885.926 364.113 947.017 387.65799 953 384 936.115 384 924.767L384 847.107C248.118 863.007 242.674 773.052 233.5 758.001 215 726.501 171.5 718.501 184.5 703.501 215.5 687.501 247 707.501 283.5 761.501 309.956 800.642 361.366 794.075 387.658 787.497 393.403 763.997 405.637 743.042 422.353 726.638 281.774 701.609 223 615.67 223 513.5 223 464.053 239.322 418.406 271.465 381.627 251.142 320.928 273.421 269.19 276.337 261.415 334.458 256.131 394.888 302.993 399.549 306.685 432.663 297.835 470.341 293 512.5 293 554.924 293 592.81 297.896 626.075 306.853 637.426 298.219 693.46 258.054 747.5 262.966 750.382 270.652 772.185 321.292 753.058 381.083 785.516 417.956 802 463.809 802 513.5 802 615.874 742.99 701.953 601.803 726.786 625.381 750.003 640 782.295 640 818.008L640 930.653C640.752 939.626 640 948.664978 655.086 948.665 832.344 888.962 960 721.389 960 524 960 276.576 759.424 76 512 76 264.577 76 64 276.576 64 524Z"></path>
</svg>
</span></span></a><div class="gt-header-comment"><textarea class="gt-header-textarea " placeholder="Leave a comment" style="overflow-x: hidden; overflow-wrap: break-word; resize: none; height: 71.4333px;"></textarea><div class="gt-header-preview markdown-body hide"></div><div class="gt-header-controls"><a class="gt-header-controls-tip" href="https://guides.github.com/features/mastering-markdown/" target="_blank" rel="noopener noreferrer"><span class="gt-ico gt-ico-tip"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 366.949535c-16.065554 0-29.982212 13.405016-29.982212 29.879884l0 359.070251c0 16.167882 13.405016 29.879884 29.982212 29.879884 15.963226 0 29.879884-13.405016 29.879884-29.879884L541.879884 396.829419C541.879884 380.763865 528.474868 366.949535 512 366.949535L512 366.949535z" p-id="3083"></path>
  <path d="M482.017788 287.645048c0-7.776956 3.274508-15.553912 8.80024-21.181973 5.525732-5.525732 13.302688-8.80024 21.181973-8.80024 7.776956 0 15.553912 3.274508 21.079644 8.80024 5.525732 5.62806 8.80024 13.405016 8.80024 21.181973 0 7.776956-3.274508 15.656241-8.80024 21.181973-5.525732 5.525732-13.405016 8.697911-21.079644 8.697911-7.879285 0-15.656241-3.274508-21.181973-8.697911C485.292295 303.301289 482.017788 295.524333 482.017788 287.645048L482.017788 287.645048z" p-id="3084"></path>
  <path d="M512 946.844409c-239.8577 0-434.895573-195.037873-434.895573-434.895573 0-239.8577 195.037873-434.895573 434.895573-434.895573 239.755371 0 434.895573 195.037873 434.895573 434.895573C946.895573 751.806535 751.755371 946.844409 512 946.844409zM512 126.17088c-212.740682 0-385.880284 173.037274-385.880284 385.777955 0 212.740682 173.037274 385.777955 385.880284 385.777955 212.740682 0 385.777955-173.037274 385.777955-385.777955C897.777955 299.208154 724.740682 126.17088 512 126.17088z" p-id="3085"></path>
</svg>
</span><span class="gt-ico-text">Markdown is supported</span></span></a><button class="gt-btn gt-btn-preview"><span class="gt-btn-text">Preview</span></button><button class="gt-btn gt-btn-login"><span class="gt-btn-text">Login with GitHub</span></button></div></div></div><div class="gt-comments"><div style="position: relative;"></div><p class="gt-comments-null">Be the first person to leave a comment!</p></div></div></div>
        <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/gitalk.css">
        <script src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/gitalk.min.js"></script>
        <script>
        var gitalk = new Gitalk({
            id: '/2022/06/21/Real-NVP-Intro/',
            clientID: '7fdcca9624f082f2fd1e',
            clientSecret: '7408a6bc70b766c85f3eaff22433262e00c848e2',
            repo: 'yuanzhi-zhu',
            owner: 'yuanzhi-zhu',
            admin: ['yuanzhi-zhu'],
            labels: ['gitment'],
            perPage: 50,
        })
        gitalk.render('gitalk-container')
        </script>
  


  </div>
</div>
</section>
<!-- /section.content -->

    <footer class="container">
        <div class="site-footer" role="contentinfo">
            <div class="copyright left mobile-block">
                    © 2019 Oct.
                    <span title="Yuanzhi Zhu">Yuanzhi Zhu</span>
                    <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a>
            </div>

            <ul class="site-footer-links right mobile-hidden">
                <li>
                    <a href="javascript:window.scrollTo(0,0)">TOP</a>
                </li>
            </ul>
            <a href="https://github.com/yuanzhi-zhu/yuanzhi-zhu.github.io" target="_blank" aria-label="view source code">
                <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
            </a>
            <ul class="site-footer-links mobile-hidden">
                
                <li>
                    <a href="http://localhost:4000/" title="Home" target="">Home</a>
                </li>
                
                <li>
                    <a href="http://localhost:4000/about/" title="About" target="">About</a>
                </li>
                
                <li><a href="http://localhost:4000/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li>
            </ul>

        </div>
    </footer>
    <div class="tools-wrapper">
      <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a>
    </div>
    <!-- / footer -->
    <script src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/share.min.js"></script>
    <script src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/geopattern.js"></script>
    <script src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/prism.js"></script>
    <link rel="stylesheet" href="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/prism.css">
    <script>
      jQuery(document).ready(function($) {
        // geopattern
        $('.geopattern').each(function(){
          $(this).geopattern($(this).data('pattern-id'));
        });
       // hljs.initHighlightingOnLoad();
      });
    </script>

    

    

    

    <!--
    
    <script type="text/javascript" src="https://basis-learning.github.io/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    -->
    
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      extensions: ["tex2jax.js"],
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true,
          processEnvironments: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          TeX: { equationNumbers: { autoNumber: "AMS" },
               extensions: ["AMSmath.js", "AMSsymbols.js"] }
      },
  "HTML-CSS": { availableFonts: ["TeX"] }
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    // Fix <code> tags after MathJax finishes running. This is a
    // hack to overcome a shortcoming of Markdown. Discussion at
    // https://github.com/mojombo/jekyll/issues/199
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script src="Introduction%20to%20Real%20NVP%20%E2%80%94%20Yuanzhi%20Zhu_files/MathJax.js" id=""></script>
    

    


<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px none; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px none; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-size-adjust: none; font-family: MathJax_Size3, sans-serif;"></div></div></body></html>